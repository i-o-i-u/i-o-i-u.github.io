{% extends "base.html" %}

{% block title %}
{{ page.title }} | {{ config.title }}
{% endblock title %}

{% block description %}
{{ page.description | default(value=page.summary | default(value=config.description)) }}
{% endblock description %}

{% block content %}
<div class="text-right">
    <div class="content-section rounded-3xl p-6 md:p-8 lg:p-12 shadow-2xl mb-12">
        <div class="flex justify-between items-center mb-8 border-b border-orange-200 pb-4">
            <h2 class="text-xl md:text-2xl lg:text-3xl font-black gradient-text">
                {{ page.title }}
            </h2>
            {% if page.slug != "questions" %}
            <div class="flex items-center gap-2">
                <div class="relative button-tooltip-wrapper">
                    <button onclick="shareContent()" class="icon-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                        </svg>
                    </button>
                    <span class="button-tooltip">شارك</span>
                </div>
                <div class="relative button-tooltip-wrapper">
                    <button onclick="copyContent()" class="icon-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <span class="button-tooltip">نسّخ النص</span>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div id="articleContent" class="prose prose-orange max-w-none text-justify leading-relaxed text-gray-700 dark:text-white text-base md:text-lg lg:text-xl">
            {{ page.content | safe }}
        </div>

        <div class="mt-12 pt-8 border-t border-orange-100 flex flex-col sm:flex-row justify-between items-center gap-4">
            <a href="javascript:history.back()" class="text-orange-600 hover:text-orange-700 font-bold flex items-center gap-2 transition-colors text-sm md:text-base">
                <span>→</span>
                عُد إلى الصفحة السابقة
            </a>
            {% if page.date %}
            <span class="text-gray-400 text-xs md:text-sm font-light">
                {{ page.date | date(format="%Y-%m-%d") }}
            </span>
            {% endif %}
        </div>

{% if page.slug != "questions" and page.slug != "writings" %}
<div class="mt-12 pt-8 border-t border-orange-100">
    <div class="flex items-center gap-3 mb-6">
        <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
        <h3 class="text-xl font-bold text-gray-800 dark:text-white">التعليقات</h3>
    </div>
    <form id="commentForm" class="space-y-4">
        <input type="text" placeholder="اسمك" maxlength="50" required class="w-full px-4 py-3 text-right bg-gray-100 dark:bg-gray-700 rounded-xl outline-none focus:ring-2 focus:ring-orange-500" dir="rtl">
        <textarea placeholder="اكتب تعليقك هنا..." maxlength="500" required class="w-full px-4 py-3 text-right bg-gray-100 dark:bg-gray-700 rounded-xl outline-none focus:ring-2 focus:ring-orange-500 min-h-[120px] resize-none" dir="rtl" oninput="document.getElementById('charCount').textContent = this.value.length"></textarea>
        <div class="flex justify-between items-center">
            <span class="text-sm text-gray-400"><span id="charCount">0</span>/500</span>
            <button type="submit" class="submit-comment-btn">
                <span>إرسال التعليق</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </button>
        </div>
    </form>
    <p class="mt-4 text-sm text-gray-400 text-center">التعليقات معطلة حاليًا</p>
</div>
{% endif %}

        </div>
    </div>
</div>

<style>
    /* Dark mode text colors - but allow backgrounds to work properly */
    body.dark #articleContent {
        color: #ffffff;
    }
    body.dark #articleContent p, 
    body.dark #articleContent h1, 
    body.dark #articleContent h2, 
    body.dark #articleContent h3,
    body.dark #articleContent li {
        color: #ffffff;
    }
    
    /* Don't force white color on elements with specific classes that need custom colors */
    body.dark #articleContent .text-orange-600,
    body.dark #articleContent .text-orange-400,
    body.dark #articleContent .text-gray-400,
    body.dark #articleContent .text-gray-300 {
        color: inherit !important;
    }
    
    body.dark .border-orange-100 {
        border-color: rgba(75, 85, 99, 0.3);
    }
    
    body.dark .bg-orange-50 {
        background-color: #1f2937 !important;
    }
    
    body.dark a[class*="bg-orange-50"] {
        background-color: #1f2937 !important;
    }
    
    body.dark a[class*="hover:bg-orange-100"]:hover {
        background-color: #374151 !important;
    }
    
    body.dark a[class*="border-orange-200"] {
        border-color: #374151 !important;
    }
    
    body.dark a[class*="hover:border-orange-400"]:hover {
        border-color: #f97316 !important;
    }
    
    body.dark .w-24.h-1 {
        background: linear-gradient(to right, transparent, #f97316, transparent) !important;
    }
    
    /* Fix comment form inputs in dark mode */
    body.dark input[type="text"],
    body.dark textarea {
        background-color: #374151 !important;
        color: #ffffff !important;
        border-color: #4b5563 !important;
    }
    
    body.dark input[type="text"]::placeholder,
    body.dark textarea::placeholder {
        color: #9ca3af !important;
    }
    
    body.dark input[type="text"]:focus,
    body.dark textarea:focus {
        background-color: #4b5563 !important;
    }
    
    /* Fix bright boxes in writings page and similar */
    body.dark .content-section {
        background-color: rgba(31, 41, 55, 0.8) !important;
    }
    
    body.dark blockquote {
        background-color: #1f2937 !important;
        border-color: #f97316 !important;
    }
    
    body.dark a > div,
    body.dark a > span {
        color: inherit;
    }
    
    .button-tooltip-wrapper {
        position: relative;
        display: inline-flex;
    }
    
    .icon-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 2.5rem;
        height: 2.5rem;
        background: linear-gradient(135deg, #fed7aa, #fdba74);
        border-radius: 0.75rem;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #ea580c;
    }
    
    .icon-btn:hover {
        background: linear-gradient(135deg, #fdba74, #fb923c);
        transform: scale(1.1);
    }
    
    body.dark .icon-btn {
        background: linear-gradient(135deg, rgba(75, 85, 99, 0.8), rgba(55, 65, 81, 0.7));
        color: #fbbf24;
    }
    
    body.dark .icon-btn:hover {
        background: linear-gradient(135deg, rgba(55, 65, 81, 0.9), rgba(75, 85, 99, 0.8));
    }
    
    .button-tooltip {
        position: absolute;
        top: calc(100% + 10px);
        left: 50%;
        transform: translateX(-50%) translateY(-10px);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
        backdrop-filter: blur(10px);
        color: #ea580c;
        padding: 8px 16px;
        border-radius: 12px;
        font-weight: bold;
        font-size: 14px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        box-shadow: 0 10px 35px rgba(251, 146, 60, 0.25);
        border: 1px solid rgba(251, 146, 60, 0.15);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        z-index: 9999;
        pointer-events: none;
    }
    
    .button-tooltip::before {
        content: '';
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        border-width: 8px;
        border-style: solid;
        border-color: transparent transparent rgba(255, 255, 255, 0.95) transparent;
    }
    
    .button-tooltip-wrapper:hover .button-tooltip {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0);
    }
    
    body.dark .button-tooltip {
        background: linear-gradient(135deg, rgba(30, 30, 30, 0.98), rgba(40, 40, 40, 0.95));
        color: #fbbf24;
        box-shadow: 0 10px 35px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(251, 191, 36, 0.25);
    }
    
    body.dark .button-tooltip::before {
        border-color: transparent transparent rgba(30, 30, 30, 0.98) transparent;
    }
    
    .submit-comment-btn {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #f59e0b, #ea580c);
        color: white;
        border: none;
        border-radius: 1rem;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(234, 88, 12, 0.3);
    }
    
    .submit-comment-btn:hover {
        background: linear-gradient(135deg, #ea580c, #dc2626);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(234, 88, 12, 0.4);
    }
    
    .submit-comment-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(234, 88, 12, 0.3);
    }
    
    .submit-comment-btn svg {
        transition: transform 0.3s ease;
    }
    
    .submit-comment-btn:hover svg {
        transform: translateX(-3px);
    }
    
    body.dark .submit-comment-btn {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }
    
    body.dark .submit-comment-btn:hover {
        background: linear-gradient(135deg, #f59e0b, #ea580c);
        box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
    }
</style>

<script>
function shareContent() {
    const title = document.querySelector('h2.gradient-text').innerText;
    const url = window.location.href;
    
    if (navigator.share) {
        navigator.share({
            title: title,
            url: url
        }).catch(err => console.log('Error sharing:', err));
    } else {
        // Fallback: copy link to clipboard
        navigator.clipboard.writeText(url).then(() => {
            const toast = document.getElementById('toast');
            toast.textContent = 'نُسِخ الرابط!';
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        });
    }
}
</script>

{% endblock content %}